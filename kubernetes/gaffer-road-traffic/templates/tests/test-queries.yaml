apiVersion: v1
kind: Pod
metadata:
  name: {{ include "gaffer-road-traffic.fullname" . }}-test-queries
  labels:
    {{- include "gaffer-road-traffic.labels" . | nindent 4 }}
    app.kubernetes.io/component: test
  annotations:
    helm.sh/hook: test-success
spec:
  restartPolicy: Never
  containers:
  - name: tests
    image: {{ .Values.testImages.curl.repository }}:{{ .Values.testImages.curl.tag }}
    workingDir: /gaffer/tests/
    command:
    - /bin/sh
    - -c
    - . ./run-tests.sh
    volumeMounts:
    - name: test-queries
      mountPath: /gaffer/tests/
      readOnly: true
  volumes:
  - name: test-queries
    configMap:
      name: {{ template "gaffer-road-traffic.fullname" . }}-test-queries
      optional: false
